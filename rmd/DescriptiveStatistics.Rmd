---
title: "Descriptive Statistics"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
---



```{css my-header-colors, echo = FALSE}
.page-header {
  background-image: linear-gradient(120deg, rgb(116, 183, 160), rgb(151, 108, 179));
}
```

```{r setup, include=FALSE}
library(knitr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(ggthemes)
library(kableExtra)
knitr::opts_chunk$set(echo = TRUE)
load('../../Ecobici.Rda')

f_color <- "#976CB3"
m_color <- "#74B7A0"
```

# Porcentage de uso

### ¿Cuántas mujeres/hombres usaron la bici por mes?

```{r echo=FALSE}
use_by_gender <- ecodata |> 
  group_by(genero_usuario, fecha_arribo) |> 
  summarise(n = n(), .groups = "drop") |> 
  #mutate(freq = n / sum(n)) |> 
  arrange(fecha_arribo) 
knitr::kable(use_by_gender |>  spread(fecha_arribo, n), 
             table.attr = "style='width:30%;'") |> 
  kable_styling()
```

### ¿A qué porcentaje corresponde?


```{r echo=FALSE}
use_by_gender_per <- ecodata |> 
  group_by(genero_usuario, fecha_arribo) |> 
  summarise(n = n(), .groups = "drop") |> 
  group_by(fecha_arribo) |> 
  mutate(freq = (n / sum(n))) |> 
  arrange(fecha_arribo) |> 
  select(-n)
knitr::kable(use_by_gender_per |> 
               mutate(freq = sprintf("%1.2f%%", freq*100)) |> spread(fecha_arribo, freq))
```
```{r echo=FALSE}
female <- use_by_gender_per |> 
  filter(genero_usuario == "F") |> 
  ungroup() |> 
  summarise(mean(freq))
male <- use_by_gender_per |> 
  filter(genero_usuario == "M") |> 
  ungroup() |> 
  summarise(mean(freq))
```


El promedio de uso de ecobici en mujeres es de `r female` y el de los hombres es `r male`


```{r echo=FALSE, fig.width=10,fig.height=4}
ggplot(use_by_gender_per, 
       aes(x = fecha_arribo, y = freq, 
           group = genero_usuario, fill = genero_usuario)) +
  geom_bar(stat="identity", position = "stack") +
  labs(title="Porcentage de uso por género", 
       subtitle="", 
       caption="", 
       fill = "Género") + 
  scale_y_continuous(labels = scales::percent) +
  theme_bw() +
  theme(axis.title.y = element_blank(),
        axis.title.x = element_blank()) +
  scale_fill_manual(values = c(f_color, m_color))
```



```{r echo=FALSE, fig.width=10,fig.height=4}
ggplot(use_by_gender_per) + 
geom_density(aes(x = freq, fill = genero_usuario), alpha=.7) + 
  facet_grid(~genero_usuario, scales = "free") + 
    labs(title="Densidad del porcentage de uso por género", 
         subtitle="",
         caption="",
         fill = "Género")+
  theme_bw() +
  theme(axis.title.x = element_blank()) +
  scale_fill_manual(values = c(f_color, m_color))
```


# Tiempo de uso

El tiempo de uso promedio de las ecobicis es `r mean(ecodata$tiempo_uso_mins)` minutos.

#### Distribución del tiempo en minutos

```{r echo=FALSE, fig.width=10,fig.height=4}
summary(ecodata$tiempo_uso_mins)
```

#### Distribución del tiempo en horas

```{r echo=FALSE, fig.width=10,fig.height=4}
summary(ecodata$tiempo_uso_hrs)
```
### Boxplot de la distrución de tiempo de uso por minutos.

```{r echo=FALSE, fig.width=10,fig.height=4}
ggplot(ecodata) + 
geom_boxplot(aes(x = tiempo_uso_mins), alpha=.7) + 
  #geom_density(aes(x = tiempo_uso_hrs)) + 
  #facet_grid(~genero_usuario, scales = "free") + 
    labs(title="Distribución de tiempo de uso de cada bicicleta (hrs)", 
         subtitle="",
         caption="",
         fill = "Género")+
  theme_bw() +
  theme(axis.title.x = element_blank())
```

```{r echo=FALSE, fig.width=10,fig.height=4}
ggplot(ecodata) + 
geom_boxplot(aes(x = tiempo_uso_mins), alpha=.7) + 
  facet_grid(~tiempo_uso_class, scales = "free") + 
    labs(title="Distribución de tiempo de uso de cada bicicleta (minutos)", 
         subtitle="",
         caption="",
         fill = "Género")+
  theme_bw() +
  theme(axis.title.x = element_blank())
```

### Proporciones de usuarios por tiempo de uso

```{r echo=FALSE, fig.width=10,fig.height=4}
ggplot(ecodata) + 
geom_boxplot(aes(x = tiempo_uso_mins ), alpha=.7) + 
  facet_grid(~tiempo_uso_class, scales = "free") + 
    labs(title="Distribución de tiempo de uso de cada bicicleta (hrs)", 
         subtitle="",
         caption="",
         fill = "Género")+
  theme_bw() +
  theme(axis.title.x = element_blank())
```


### Proporción de usuarios por tiempo de uso

```{r echo=FALSE, fig.width=10,fig.height=4}
tab_tiempo <- ecodata |> 
  group_by(tiempo_uso_class) |> 
  summarise(n = n()) |> 
  mutate(porcentaje = sprintf("%1.2f%%", n/sum(n) * 100))

print(tab_tiempo)
```

### Distribución de tiempo de uso por género (menos de 45 min)


```{r echo=FALSE, fig.width=10,fig.height=4}
ggplot(ecodata |> filter(tiempo_uso_mins <= 45)) + 
geom_boxplot(aes(x = tiempo_uso_mins, color = genero_usuario), alpha=.7) + 
  facet_grid(~genero_usuario, scales = "free") + 
    labs(title="Distribución de tiempo de uso de cada bicicleta (hrs)", 
         subtitle="",
         caption="",
         fill = "Género")+
  theme_bw() +
  theme(axis.title.x = element_blank()) +
  scale_color_manual(values = c(f_color, m_color)) +
  coord_flip()

```


